GETTEXT_PACKAGE ?= abiword
LOCALE ?= $(LANG)

MSGFMT = @MSGFMT@
MSGINIT = msginit

prefix = @prefix@
datarootdir = @datarootdir@
localedir = @localedir@

top_srcdir = @top_srcdir@

po_files = $(wildcard *.po)
mo_files = $(subst .po,.mo, $(po_files))
langs = $(subst .po,, $(po_files))
catfile = $(localedir)/%s/LC_MESSAGES/$(GETTEXT_PACKAGE).mo
instfile = $(subst %s,$(1),$(catfile))

all: $(mo_files)

dist:

clean:
	rm -f $(mo_files) $(GETTEXT_PACKAGE).pot

distclean distclean-recursive: clean

maintainer-clean maintainer-clean-recursive: distclean-recursive

install: all
	@$(foreach lang, $(langs), if test -d $(dir $(call instfile,$(lang))); then install -m 644 $(lang).mo $(call instfile,$(lang)); echo Installing $(call instfile,$(lang)); fi; )

uninstall:
	@$(foreach lang, $(langs), if test -f $(call instfile,$(lang)); then rm -f $(call instfile,$(lang)); echo Uninstalling $(call instfile,$(lang)); fi; )

update-po: pot
	@$(foreach lang, $(langs), echo Updating locale $(lang); intltool-update --gettext-package $(GETTEXT_PACKAGE) $(lang); )

%.mo: %.po
	$(MSGFMT) -o $@ $<

pot: $(GETTEXT_PACKAGE).pot

translate: pot
	$(MSGINIT) --locale=$(LOCALE)

$(GETTEXT_PACKAGE).pot:
	intltool-update --pot --gettext-package=$(GETTEXT_PACKAGE)
